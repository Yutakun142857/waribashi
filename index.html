<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>割りばし解析用</title>
    <style>
        body {
            background-color: rgb(221, 213, 236);
            text-align: center;
        }

        #menu {
            margin: 0 auto;
            padding: 10px;
            width: 300px;
            border: 2px solid black;
            border-radius: 20px;
            text-align: left;
        }

        button {
            border: 1px solid black;
            border-radius: 10px;
            padding: 10px 20px;
        }

        table {
            border-collapse: collapse;
            margin: 0 auto;
        }

        td {
            width: 30px;
            height: 30px;
        }

        .w {
            background-color: rgb(245, 208, 174);
        }
        .l {
            background-color: rgb(181, 224, 231);
        }
    </style>
</head>

<body>
    <h1>割りばしゲーム解析用</h1>
    <p>wiki: <a
            href="https://ja.wikipedia.org/wiki/%E5%89%B2%E3%82%8A%E7%AE%B8_(%E6%89%8B%E9%81%8A%E3%81%B3%E3%82%B2%E3%83%BC%E3%83%A0)#%E3%83%AB%E3%83%BC%E3%83%AB">こちら</a>
    </p>
    <p id="menu">
        <label><input type="radio" name="ro" value="ro" id="ro" checked>ロールオーバー</label>　<label><input type="radio"
                name="ro" value="co">カットオフ</label><br>
        <label><input type="checkbox" id="転送" checked>転送 (23 -> 14) </label><br>
        <label><input type="checkbox" id="分裂" checked>分裂 (03 -> 12) </label><br>
        <label><input type="checkbox" id="自殺" checked>自殺 (12 -> 03) </label><br>
        <label><input type="checkbox" id="メタ">メタ (44 -> 12) </label><br>
        <label><input type="checkbox" id="逆形">逆形 (死んだら勝利) </label><br>
    </p>
    <p>
        <button id="start">解析する</button>
    </p>
    <table border="1">
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
</body>
<script>
    document.getElementById("start").addEventListener("click", () => {
        let ra = document.getElementById("転送").checked,
            rb = document.getElementById("分裂").checked,
            rc = document.getElementById("自殺").checked,
            rd = document.getElementById("メタ").checked,
            rf = document.getElementById("逆形").checked,
            rg = document.getElementById("ro").checked;
        function next(str) {
            if (str.length != 4) {
                return null;
            }
            let a = str.charAt(0),
                b = str.charAt(1),
                c = str.charAt(2),
                d = str.charAt(3),
                na = parseInt(a),
                nb = parseInt(b),
                nc = parseInt(c),
                nd = parseInt(d);
            ans = [];
            if (na * nc > 0) {
                if (!rg) {
                    if ((na + nc) >= 5) {
                        ans.push("0" + d + a + b);
                    } else {
                        if (na + nc > nd) {
                            ans.push(d + (na + nc) + a + b);
                        } else {
                            ans.push((na + nc) + d + a + b);
                        }
                    }
                } else {
                    if ((na + nc) % 5 > nd) {
                        ans.push(d + (na + nc) % 5 + a + b);
                    } else {
                        ans.push((na + nc) % 5 + d + a + b);
                    }
                }
            }
            if (nb * nc > 0) {
                if (!rg) {
                    if ((nb + nc) >= 5) {
                        ans.push("0" + d + a + b);
                    } else {
                        if (nb + nc > nd) {
                            ans.push(d + (nb + nc) + a + b);
                        } else {
                            ans.push((nb + nc) + d + a + b);
                        }
                    }
                } else {
                    if ((nb + nc) % 5 > nd) {
                        ans.push(d + (nb + nc) % 5 + a + b);
                    } else {
                        ans.push((nb + nc) % 5 + d + a + b);
                    }
                }
            }
            if (na * nd > 0) {
                if (!rg) {
                    if ((na + nd) >= 5) {
                        ans.push("0" + c + a + b);
                    } else {
                        if (na + nd > nc) {
                            ans.push(c + (na + nd) + a + b);
                        } else {
                            ans.push((na + nd) + c + a + b);
                        }
                    }
                } else {
                    if ((na + nd) % 5 > nc) {
                        ans.push(c + (na + nd) % 5 + a + b);
                    } else {
                        ans.push((na + nd) % 5 + c + a + b);
                    }
                }
            }
            if (nb * nd > 0) {
                if (!rg) {
                    if ((nb + nd) >= 5) {
                        ans.push("0" + c + a + b);
                    } else {
                        if (nb + nd > nc) {
                            ans.push(c + (nb + nd) + a + b);
                        } else {
                            ans.push((nb + nd) + c + a + b);
                        }
                    }
                } else {
                    if ((nb + nd) % 5 > nc) {
                        ans.push(c + (nb + nd) % 5 + a + b);
                    } else {
                        ans.push((nb + nd) % 5 + c + a + b);
                    }
                }
            }
            if ((ra && na * nb > 0) || (rb && na * nb == 0)) {
                for (let i = Math.floor((na + nb) / 2); i > 0 && i % 5 + (na + nb - i) % 5 == na + nb; i--) {
                    if (i != na) {
                        ans.push(c + d + i + (na + nb - i));
                    }
                }
            }
            if (ra && rc && na * nb > 0 && na + nb < 5) {
                ans.push(c + d + "0" + (na + nb));
            }
            if (rd && na + nb > 5) {
                for (let i = Math.floor((na + nb - 5) / 2); (rc ? (i >= 0) : (i > 0)) && i % 5 + (na + nb - i) % 5 == na + nb - 5; i--) {
                    if (i != na && (ra || i==0)) {
                        ans.push(c + d + i + (na + nb - i - 5));
                    }
                }
            }
            return Array.from(new Set(ans));
        }
        const l = ["00", "01", "02", "03", "04", "11", "12", "13", "14", "22", "23", "24", "33", "34", "44"];
        let win = ['0100', '0200', '0300', '0400', '1100', '1200', '1300', '1400', '2200', '2300', '2400', '3300', '3400', '4400'];
        let lose = ['0001', '0002', '0003', '0004', '0011', '0012', '0013', '0014', '0022', '0023', '0024', '0033', '0034', '0044'];
        if (rf) [win, lose] = [lose, win];
        let lm = "", wm = "";
        while (JSON.stringify(lose) != lm || JSON.stringify(win) != wm) {
            lm = JSON.stringify(lose);
            wm = JSON.stringify(win);
            for (let j = 0; j < l.length; j++) {
                for (let k = 0; k < l.length; k++) {
                    if (j + k == 0) continue;
                    const p = l[j] + l[k];
                    if (!win.includes(p) && !lose.includes(p)) {
                        const np = next(p);
                        if (np.every(e => win.includes(e))) lose.push(p);
                        if (np.some(e => lose.includes(e))) win.push(p);
                    }
                }
            }
        }
        document.querySelector("tbody").innerHTML = "<td></td><td>" + l.join("</td><td>") + "</td>" + l.map((e, i) =>"<tr><td>" + e + "</td>" + l.map(f => win.includes(f + e) ? "<td class=\"w\">勝</td>" : lose.includes(f + e) ? "<td class=\"l\">敗</td>" : "<td></td>").join("") + "</tr>").join("")
    });
</script>

</html>